import { useEffect, useState } from "react";
import type { NextPage } from "next";
import Head from "next/head";
import { useRouter } from "next/router";
import { Box, Button, Text } from "@mantine/core";
import { useLogin } from "@soul-project/react-soul-utils";
import { File } from "tabler-icons-react";

import NavigationBar from "../../components/NavigationBar";
import Footer from "../../components/Footer";
import Page from "../../components/Page";
import axios from "axios";

const Author: NextPage = () => {
  const router = useRouter();
  const { userId } = router.query;

  const { userCredentials, login, logout, isLoggingIn } = useLogin({
    platformId: 2,
    callback: "http://localhost:3000",
  });
  const [username, setUsername] = useState<string | undefined>();

  useEffect(() => {
    const getUsername = async () => {
      const {
        data: { username },
      } = await axios.get(`/api/authors/${userId}`);
      setUsername(username);
    };
    if (userId) {
      getUsername();
    }
  }, [userId]);

  return (
    <div>
      <Head>
        <title>Liberal</title>
        <meta
          name="description"
          content="Generated by create next app"
          charSet="utf-8"
        />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <Page>
          <NavigationBar
            username={userCredentials?.username}
            onLogin={login}
            onLogout={logout}
            isLoggingIn={isLoggingIn}
            primaryButton={
              <Button component="a" href="/new" rightIcon={<File />}>
                New Article
              </Button>
            }
          />
          <Box
            sx={() => ({
              padding: "10px 30px 30px 30px",
            })}
          >
            <Text
              sx={() => ({
                color: "white",
                fontSize: "30px",
              })}
            >
              {username}
            </Text>
          </Box>
        </Page>
      </main>
      <Footer />
    </div>
  );
};

export default Author;
